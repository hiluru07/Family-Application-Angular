<div class="container py-4">

  <!-- ==================== PROFILE CARD ==================== -->
  <div class="profile-card">
    <img [src]="profilepath" />
    <div>
      <h4 class="fw-bold mb-1"><i class="bi bi-person-circle me-1"></i>{{ username }}</h4>
      <p class="mb-1"><i class="bi bi-person-badge me-1"></i>{{ Fname }} {{ Lname }}</p>
      <p class="mb-1"><i class="bi bi-telephone-fill me-1"></i>{{ Phone }}</p>
      <p class="mb-3"><i class="bi bi-envelope-fill me-1"></i>{{ Email }}</p>
      <button class="btn btn-light btn-sm btn-custom" (click)="openEditProfileModal()">
        <i class="bi bi-pencil-square me-1"></i> Edit Profile
      </button>
    </div>
  </div>

  <!-- ==================== ADD MEMBER BUTTON ==================== -->
  <div class="text-end mb-4">
    <button class="btn btn-gradient btn-custom" (click)="openAddMemberModal()">
      <i class="bi bi-person-plus me-1"></i> Add Member
    </button>
  </div>

  <!-- ==================== MEMBERS CARDS ==================== -->
  <div *ngIf="members.length > 0; else nodata">
    <div *ngFor="let member of members" class="member-card">
      <!-- Profile Image -->
      <img [src]="getMemberImage(member)" width="80" height="80" class="rounded-circle border"
        style="object-fit: cover;">

      <!-- Member Info -->
      <div class="member-info ms-3 flex-grow-1">
        <h5><i class="bi bi-person-fill me-1"></i>{{ member.name }}</h5>
        <p><i class="bi bi-calendar3 me-1"></i>Age: {{ member.age }} |
          <i class="bi bi-gender-ambiguous me-1"></i>Gender: {{ member.gender }} |
          <i class="bi bi-people-fill me-1"></i>Relation: {{ member.relation }}
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="member-actions d-flex gap-2">
        <button class="btn btn-warning btn-sm" (click)="openEditMemberModal(member)">
          <i class="bi bi-pencil-square"></i>
        </button>
        <button class="btn btn-danger btn-sm" (click)="deleteMember(member.id)">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- No Data -->
  <ng-template #nodata>
    <div class="text-center text-muted py-4" style="font-size:1rem; color:#888;">
      You did not add any family member yet.
    </div>
  </ng-template>
</div>

<!-- ==================== ADD MEMBER MODAL ==================== -->
<div class="modal fade" #AddMemberModal>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background: linear-gradient(135deg,#ff758c,#ff7eb3); color:white;">
        <h5 class="modal-title"><i class="bi bi-person-plus me-1"></i>Add Member</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form [formGroup]="AddMemberForm" (ngSubmit)="submitAddMemberForm()">
        <div class="modal-body">
          <!-- Image -->
          <div class="mb-3 text-center">
            <img [src]="addMemberPreview" width="100" height="100" class="rounded-circle border mb-3">
            <input type="file" #addFileInput (change)="onAddMemberFileSelect($event)" accept="image/*" hidden>
            <div class="d-flex justify-content-center gap-2">
              <button type="button" class="btn btn-secondary btn-sm" (click)="addFileInput.click()">
                <i class="bi bi-image me-1"></i>Select Profile Image
              </button>
              <button type="button" class="btn btn-danger btn-sm" (click)="removeAddMemberImage()">
                <i class="bi bi-x-circle me-1"></i>Remove
              </button>
            </div>
          </div>

          <!-- NAME -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-person-fill me-1"></i>Name</label>
            <input class="form-control" formControlName="name">
            <div class="text-danger" *ngIf="AddMemberForm.get('name')?.invalid && AddMemberForm.get('name')?.touched">
              Name is required
            </div>
          </div>

          <!-- AGE -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-calendar3 me-1"></i>Age</label>
            <input type="number" class="form-control" formControlName="age">
            <div class="text-danger" *ngIf="AddMemberForm.get('age')?.invalid && AddMemberForm.get('age')?.touched">
              Age is required
            </div>
          </div>

          <!-- GENDER -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-gender-ambiguous me-1"></i>Gender</label>
            <select class="form-select" formControlName="gender">
              <option value="">Select</option>
              <option>Male</option>
              <option>Female</option>
            </select>
            <div class="text-danger"
              *ngIf="AddMemberForm.get('gender')?.invalid && AddMemberForm.get('gender')?.touched">
              Gender is required
            </div>
          </div>

          <!-- RELATION -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-people-fill me-1"></i>Relation</label>
            <select class="form-select" formControlName="relation">
              <option value="">Select</option>
              <option *ngFor="let r of Relations">{{ r }}</option>
            </select>
            <div class="text-danger"
              *ngIf="AddMemberForm.get('relation')?.invalid && AddMemberForm.get('relation')?.touched">
              Relation is required
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeAddMemberModal()"><i
              class="bi bi-x-circle me-1"></i>Cancel</button>
          <button class="btn btn-success" [disabled]="AddMemberForm.invalid"><i
              class="bi bi-check-circle me-1"></i>Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ==================== EDIT MEMBER MODAL ==================== -->
<div class="modal fade" #EditMemberModal>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background: linear-gradient(135deg,#6a11cb,#2575fc); color:white;">
        <h5 class="modal-title"><i class="bi bi-pencil-square me-1"></i>Edit Member</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form [formGroup]="EditMemberForm" (ngSubmit)="submitEditMemberForm()">
        <div class="modal-body">
          <!-- Image -->
          <div class="mb-3 text-center">
            <img [src]="editMemberPreview" width="100" height="100" class="rounded-circle border mb-3">
            <input type="file" #editFileInput (change)="onEditMemberFileSelect($event)" accept="image/*" hidden>
            <div class="d-flex justify-content-center gap-2">
              <button type="button" class="btn btn-secondary btn-sm" (click)="editFileInput.click()">
                <i class="bi bi-image me-1"></i>Select Profile Image
              </button>
              <button type="button" class="btn btn-danger btn-sm" (click)="removeEditMemberImage()">
                <i class="bi bi-x-circle me-1"></i>Remove
              </button>
            </div>
          </div>

          <!-- NAME -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-person-fill me-1"></i>Name</label>
            <input class="form-control" formControlName="name">
            <div class="text-danger" *ngIf="EditMemberForm.get('name')?.invalid && EditMemberForm.get('name')?.touched">
              Name is required
            </div>
          </div>

          <!-- AGE -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-calendar3 me-1"></i>Age</label>
            <input type="number" class="form-control" formControlName="age">
            <div class="text-danger" *ngIf="EditMemberForm.get('age')?.invalid && EditMemberForm.get('age')?.touched">
              Age is required
            </div>
          </div>

          <!-- GENDER -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-gender-ambiguous me-1"></i>Gender</label>
            <select class="form-select" formControlName="gender">
              <option value="">Select</option>
              <option>Male</option>
              <option>Female</option>
            </select>
            <div class="text-danger"
              *ngIf="EditMemberForm.get('gender')?.invalid && EditMemberForm.get('gender')?.touched">
              Gender is required
            </div>
          </div>

          <!-- RELATION -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-people-fill me-1"></i>Relation</label>
            <select class="form-select" formControlName="relation">
              <option value="">Select</option>
              <option *ngFor="let r of Relations">{{ r }}</option>
            </select>
            <div class="text-danger"
              *ngIf="EditMemberForm.get('relation')?.invalid && EditMemberForm.get('relation')?.touched">
              Relation is required
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeEditMemberModal()"><i
              class="bi bi-x-circle me-1"></i>Cancel</button>
          <button class="btn btn-success" [disabled]="EditMemberForm.invalid"><i
              class="bi bi-check-circle me-1"></i>Update</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ==================== EDIT PROFILE MODAL ==================== -->
<div class="modal fade" #EditProfileModal>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background: linear-gradient(135deg, #7b2ff7, #f107a3); color:white;">
        <h5 class="modal-title"><i class="bi bi-pencil-square me-1"></i>Edit Profile</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form [formGroup]="EditProfileForm" (ngSubmit)="updateProfile()">
        <div class="modal-body">
          <!-- PROFILE IMAGE -->
          <div class="text-center mb-3">
            <img [src]="ImagePreview || profilepath" width="110" height="110" class="rounded-circle border mb-3">
            <input type="file" class="form-control mt-2" (change)="onProfileImageSelect($event)">
          </div>

          <!-- USERNAME -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-person-circle me-1"></i>Username</label>
            <input class="form-control" formControlName="username">
            <div class="text-danger"
              *ngIf="EditProfileForm.get('username')?.invalid && EditProfileForm.get('username')?.touched">
              Username is required
            </div>
          </div>

          <!-- FIRST NAME -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-person-badge me-1"></i>First Name</label>
            <input class="form-control" formControlName="fname">
          </div>

          <!-- LAST NAME -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-person-badge me-1"></i>Last Name</label>
            <input class="form-control" formControlName="lname">
          </div>

          <!-- PHONE -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-telephone-fill me-1"></i>Phone</label>
            <input class="form-control" formControlName="phone">
            <div class="text-danger"
              *ngIf="EditProfileForm.get('phone')?.invalid && EditProfileForm.get('phone')?.touched">
              Enter valid phone number
            </div>
          </div>

          <!-- EMAIL -->
          <div class="mb-2">
            <label class="form-label"><i class="bi bi-envelope-fill me-1"></i>Email</label>
            <input class="form-control" formControlName="email">
            <div class="text-danger"
              *ngIf="EditProfileForm.get('email')?.invalid && EditProfileForm.get('email')?.touched">
              Enter valid email address
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" (click)="closeEditProfileModal()"><i
              class="bi bi-x-circle me-1"></i>Cancel</button>
          <button class="btn btn-success" type="submit" [disabled]="EditProfileForm.invalid"><i
              class="bi bi-check-circle me-1"></i>Update</button>
        </div>
      </form>
    </div>
  </div>
</div>